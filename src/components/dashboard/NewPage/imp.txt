import {
  View,
  Text,
  ImageBackground,
  TouchableOpacity,
  Dimensions,
  Pressable,
  Image,
} from 'react-native';
import React, {useEffect, useState} from 'react';
import Carousel from 'react-native-reanimated-carousel';
import {Pagination} from 'react-native-snap-carousel';
import axios from 'axios';
import {
  BASE_IMG_URL,
  BASE_URL,
  MOVIE_UPCOMING,
  TRENDING_URL,
  TRENDING_URL_TV,
} from '../../../services';
import styles from './styles';
import {useNavigation} from '@react-navigation/native';
import {FlatList} from 'react-native';
import {useQuery} from 'react-query';
import {FetchUpcomingMovie} from '../../../services/FetchData';

export const UpcomingMovies = () => {
  const {data} = useQuery('Upcoming Movies', FetchUpcomingMovie);
  <FlatList
    data={data}
    renderItem={item => (
      <View>
        <ImageBackground
          resizeMode="contain"
          style={{height: 225, width: 150}}
          source={{
            uri: BASE_IMG_URL + 'original' + item.poster_path,
          }}></ImageBackground>
      </View>
    )}
  />;
};

const width = Dimensions.get('window').width;
const NewPage = () => {
  const [data, setData] = useState([]);
  const [index, setIndex] = React.useState(0);
  const isCarousel = React.useRef(null);
  const FetchCarouselData = async () => {
    const trendingMovie = await axios.get(BASE_URL + MOVIE_UPCOMING);
    const trendingTv = await axios.get(BASE_URL + TRENDING_URL_TV);

    const MovieData = trendingMovie.data.results.slice(0, 2).map(item => {
      return {
        // ...GiveData,
        id: item.id,
        release_date: item.release_date ? item.release_date : null,
        backdrop_path: item.backdrop_path
          ? BASE_IMG_URL + 'original' + item.backdrop_path
          : BASE_IMG_URL + 'original' + item.poster_path,
        // title: item.title,
        title: item.title ? item.title : 'Movie Upcoming',

        poster_path: item.poster_path
          ? BASE_IMG_URL + 'original' + item.poster_path
          : null,
        overview: item.overview ? item.overview : null,
      };
    });
    // const TvData = trendingTv.data.results.slice(0, 2).map(item => {
    //   return {
    //     id: item.id,
    //     release_date: item.release_date ? item.release_date : null,
    //     backdrop_path: item.backdrop_path
    //       ? BASE_IMG_URL + 'original' + item.backdrop_path
    //       : BASE_IMG_URL + 'original' + item.poster_path,
    //     title: item.title,
    //     // title: item.title ? item.title : null,

    //     poster_path: item.poster_path
    //       ? BASE_IMG_URL + 'original' + item.poster_path
    //       : null,
    //     overview: item.overview ? item.overview : null,
    //   };
    // });
    setData([...MovieData]);
  };

  useEffect(() => {
    FetchCarouselData();
  }, []);
  // console.log(data);
  const {navigate} = useNavigation();
  const renderFunc = ({item}) => {
    return (
      <Pressable
        onPress={() => {
          navigate('MovieDetail', {item});
        }}>
        <View>
          {item.backdrop_path && (
            <ImageBackground
              resizeMode="cover"
              style={styles.imgStyle}
              source={{uri: item.backdrop_path}}
            />
          )}
        </View>
      </Pressable>
    );
  };

  return (
    <View style={{flex: 1, backgroundColor: 'red'}}>
      <Carousel
        data={data}
        renderItem={renderFunc}
        style={{backgroundColor: 'yellow'}}
        loop
        ref={isCarousel}
        autoPlay={true}
        // autoplayInterval={3000}
        scrollAnimationDuration={1000}
        // sliderWidth={width}
        // itemWidth={width}
        width={width}
        height={(width * 1) / 1.7}
        onSnapToItem={index => setIndex(index)}
        // useScrollView={true}
      />
      {/* <Pagination
        dotsLength={data.length}
        activeDotIndex={index}
        carouselRef={isCarousel}
        dotStyle={{
          width: 10,
          height: 10,
          borderRadius: 5,
          marginHorizontal: 0,
          backgroundColor: 'rgba(0, 0, 0, 0.92)',
        }}
        inactiveDotOpacity={0.4}
        inactiveDotScale={0.6}
        tappableDots={true}
      /> */}
      <View style={{backgroundColor: 'red'}}>
        <Text
          style={{color: 'black', fontSize: 18, margin: 10, marginLeft: 15}}>
          Upcoming Movies
        </Text>
      </View>
    </View>
  );
};

export default NewPage;
